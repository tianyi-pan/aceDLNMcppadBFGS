## START example for random effect
library(aceDLNMcppadBFGS)
# library(aceDLNM)
library(mgcv)
maxL <- 14
theta <- 8
Nt <- 1000
gt <- function(x) sin(x/150)
ttmp <- 1:1014
ttmp <- ttmp[-(1:maxL)]
meangt <- mean(gt(ttmp))
otherterm1 <- data.frame(trend = gt(ttmp) - meangt,
intercept = 0)
otherterm2 <- data.frame(trend = gt(ttmp) - meangt,
intercept = 1)
dat.gen1 <- GenerateData(fEtype = "quadratic", wltype = "type1",
Nt = Nt,
theta = theta,
maxL = maxL,
interpolate = TRUE,
other = otherterm1)
dat.gen2 <- GenerateData(fEtype = "quadratic", wltype = "type1",
Nt = Nt,
theta = theta,
maxL = maxL,
interpolate = TRUE,
other = otherterm2)
dat <- data.frame(x = c(dat.gen1$x, dat.gen2$x),
t = c(dat.gen1$t, dat.gen2$t),
y = c(dat.gen1$y, 2*dat.gen2$y),
id = as.factor(c(rep("a", 1014), rep("b", 1014))),
logpop = log(c(rep(1000, 1014), rep(2000, 1014))))
results <- aceDLNM(formula = y~sX(t, x, by = id),
smooth = ~ s(t, bs = "bs") + s(id, bs = "re"),
offset = ~ logpop,
dat = dat,
kw = 20,
kE = 20,
maxL = maxL,
verbose = TRUE)
true.function <- dat.gen1$true.f
true.function$smooth <- function(x,var){
if(var == "t") gt(x) - meangt
}
summary(results, plot = TRUE, true.function = true.function)
?aceDLNM
dat.gen1 <- GenerateData(fEtype = "quadratic", wltype = "type1",
Nt = Nt,
theta = theta,
maxL = maxL,
interpolate = TRUE,
other = otherterm1)
dat.gen2 <- GenerateData(fEtype = "quadratic", wltype = "type1",
Nt = Nt,
theta = theta,
maxL = maxL,
interpolate = TRUE,
other = otherterm2)
dat <- data.frame(x = c(dat.gen1$x, dat.gen2$x),
t = c(dat.gen1$t, dat.gen2$t),
y = c(dat.gen1$y, 2*dat.gen2$y),
id = as.factor(c(rep("a", 1014), rep("b", 1014))),
logpop = log(c(rep(1000, 1014), rep(2000, 1014))))
results <- aceDLNM(formula = y~sX(t, x, by = id),
smooth = ~ s(t, bs = "bs") + s(id, bs = "re"),
offset = ~ logpop,
dat = dat,
kw = 20,
kE = 20,
maxL = maxL,
verbose = TRUE)
